#!/bin/bash
set -e

git clone --bare https://github.com/b2l/cfg.git $HOME/.cfg
function config {
   /usr/bin/git --git-dir=$HOME/.cfg/ --work-tree=$HOME $@
}
mkdir -p .config-backup
config checkout
if [ $? = 0 ]; then
  echo "Checked out config.";
  else
    echo "Backing up pre-existing dot files.";
    config checkout 2>&1 | egrep "\s+\." | awk {'print $1'} | xargs -I{} mv {} .config-backup/{}
fi;
config checkout
config config status.showUntrackedFiles no

echo "================="
echo "Updating packages"
sudo dnf --refresh update -y
sudo dnf -y install dnf-plugins-core

echo "================="
echo "Installing packages"
sudo dnf install -y \
  --skip-unavailable \
  --allowerasing \
  vim \
  autoconf \
  automake \
  cmake \
  ctags \
  dunst \
  fedora-workstation-repositories \
  fuse-sshfs \
  gcc-c++ \
  htop \
  httpie \
  hyprland \
  hyprland-devel \
  hyprpaper \
  hypridle \
  imv \
  mpv \
  bat \
  waybar \
  jq \
  keychain \
  lcov \
  libffi-devel \
  libtool \
  libxslt-devel \
  libyaml-devel \
  NetworkManager \
  NetworkManager-tui \
  ncurses-devel \
  openssl-devel \
  readline-devel \
  foot \
  unixODBC-devel \
  util-linux-user \
  flatpak \
  fira-code-fonts \
  freetype-devel cairo-devel pango-devel wayland-devel libxkbcommon-devel harfbuzz \
  meson scdoc wayland-protocols-devel \
  zsh

dnf copr enable pennbauman/ports
dnf install lf

flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo

flatpak install -y --noninteractive flathub com.spotify.Client
flatpak install -y --noninteractive flathub org.mozilla.firefox
flatpak install -y --noninteractive flathub com.vscodium.codium
flatpak install -y --noninteractive org.mozilla.Thunderbird
